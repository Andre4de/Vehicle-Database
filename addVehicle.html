<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="utf-8"/>
        <title> Add a Vehicle </title>
        <link rel="stylesheet" href="stylesheet.css">
       
        
    </head>

    <body>
       
          <div id="container">

            <header>

                <h1>Add a Vehicle </h1>

                    <nav>
                        <ul>
                            <li><a href="index.html">People Search</a>        
                            <li><a href="vehicle.html">Vehicle Search</a>   
                            <li><a href="addVehicle.html"> Add a Vehicle  </a>
                        </ul>
                    </nav>
             </header>

            <div class="sidebar">
                <h3>Sidebar</h3>
                <aside>
                <img src="addveh.png" alt="image of vehicles" class="img">
                 </aside>

  
            </div>

            <div class='main'>
                <h2>Main</h2>
                <form id="addVehicle">

                    <label for="carid">Vehicle ID:</label>
                    <input type="search" id="rego" name="vehiclenum" placeholder="Search...">
                    
                     <br>

                    <label for="carmake">Vehicle Make:</label>
                    <input type="search" id="make" name="vehiclemake" placeholder="Search...">

                    <br>

                    <label for="carmodel">Vehicle Model:</label>
                    <input type="search" id="model" name="vehiclemodel" placeholder="Search...">

                    <br>

                    <label for="carcolour">Vehicle Colour:</label>
                    <input type="search" id="colour" name="vehiclecolour" placeholder="Search...">

                    <br>

                    <label for="carowner">Owner ID:</label>
                    <input type="search" id="owner" name="vehicleowner" placeholder="Search...">

                    <br>

                    <button type="submit" id="click">Add vehicle</button> 

                    <br>

                    <br>

                </form>

                <form id="form2">

                <label for="pID">personid :</label>
                <input type="search" id="personid" name="pID" placeholder="Search...">
                
                    <br>

                <label for="nome">owner name:</label>
                <input type="search" id="name" name="nameit" placeholder="Search...">

                <br>

                <label for="addr">owner address:</label>
                <input type="search" id="address" name="srchit" placeholder="Search...">

                <br>

                <label for="dob">owner dob:</label>
                <input type="search" id="dob" name="dobby" placeholder="Search...">

                <br>

                <label for="lic">owner license:</label>
                <input type="search" id="license" name="lic" placeholder="Search...">

                <br>

                <label for="expirdy">license expiring date:</label>
                <input type="search" id="expire" name="expiry" placeholder="Search...">

                <br>

                <button type="submit" id="click2">Add owner</button> 

                <br>

            </form>

                <br>
                
                <div id="results"></div>
            </div>

            

            <div class="footer">
                <h4>Footer</h4>
                <div id="message"></div>
            </div>

          </div>
          <script type="module" defer>

            import { createClient } from
               'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
   
            const supabase = createClient('https://ugspricsaeopciltqhlf.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVnc3ByaWNzYWVvcGNpbHRxaGxmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTIyNTYyMjAsImV4cCI6MjAyNzgzMjIyMH0.tXrrGVvxsy5yKal2ROjrDUNWqHbabRehpfI35-MF1vQ');
                let results = document.getElementById("results");
                const message = document.getElementById("message");
               
        
            document.getElementById("addVehicle").addEventListener("submit", async function (event){
                event.preventDefault();
                
                let regoI = document.getElementById("rego").value
                let makeI= document.getElementById("make").value
                let modelI = document.getElementById("model").value
                let colourI = document.getElementById("colour").value
                let owneridI = document.getElementById("owner").value

         


                if(regoI === ''|| makeI === '' ||modelI === '' || colourI === '' || owneridI === ''){
                
                message.innerHTML = "Error";
                return;
            }


                try{

                const query = supabase.from("Vehicles").select("OwnerID").eq("OwnerID", owneridI);

                let { data: checkPpl, error : vehErr } = await query;

                

                if(checkPpl.length === 0){
                console.log("No one there")
                
                
                document.getElementById("form2").style.display = "block";

                document.getElementById("form2").addEventListener("submit", async function (event){
                event.preventDefault();
                    
                let personidI = document.getElementById("personid").value
                let nameI = document.getElementById("name").value
                let addressI = document.getElementById("address").value
                let dobI = document.getElementById("dob").value
                let licenseI = document.getElementById("license").value
                let expireI = document.getElementById("expire").value

                if(personidI === ''|| nameI === '' ||addressI === '' || dobI === '' || licenseI === '' || expireI === ''){
                
                    message.innerHTML = "Error";
                    return;
                }
    
                const query3 = supabase.from('People').insert({ PersonID: personidI, Name: nameI, Address: addressI, DOB: dobI, LicenseNumber: licenseI, ExpiryDate: expireI})

                const { error: pplIn} = await query3

                owneridI = personidI

                const query4 = supabase.from('Vehicles').insert({ VehicleID: regoI, Make: makeI, Model: modelI, Colour: colourI, OwnerID: owneridI})

                const { error: vehIn} = await query4
                
                
                message.textContent = "Vehicle added successfully";

                document.getElementById("form2").style.display = "none";

                });
                return
 
                

               


                

                }else{
                  
                    console.log("A person with that id already exists.")

                    const query2 = supabase.from('Vehicles').insert({ VehicleID: regoI, Make: makeI, Model: modelI, Colour: colourI, OwnerID: owneridI})

                    const { error: vehIn} = await query2

                    
                    message.textContent = "Vehicle added successfully";

                    

                    
                }


            }catch(error){
                console.log(error)
            }  

           


            });
            
                
                      </script> 
                      
                </body>
            
            </html>
    </body>

</html>