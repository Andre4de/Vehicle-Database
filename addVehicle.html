<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="utf-8"/>
        <title> Add a Vehicle </title>
        <link rel="stylesheet" href="stylesheet.css">
       
        
    </head>

    <body>
       
          <div id="container">

            <header>

                <h1>Add a Vehicle </h1>

                    <nav>
                        <ul>
                            <li><a href="index.html">People Search</a>        
                            <li><a href="vehicle.html">Vehicle Search</a>   
                            <li><a href=""> Add a Vehicle  </a>
                        </ul>
                    </nav>
             </header>

            <div class="sidebar">
                <h3>Sidebar</h3>
                <aside>
                <img src="addveh.png" alt="image of vehicles" class="img">
                 </aside>

  
            </div>

            <div class="main">
                <h2>Main</h2>
                <form id="addVeh">

                    <label for="rego">License:</label>
                    <input type="search" id="rego" name="rego" placeholder="Search...">
                    
                     <br>

                    <label for="make">Vehicle Make:</label>
                    <input type="search" id="make" name="make" placeholder="Search...">

                    <br>

                    <label for="model">Vehicle Model:</label>
                    <input type="search" id="model" name="model" placeholder="Search...">

                    <br>

                    <label for="colour">Vehicle Colour:</label>
                    <input type="search" id="colour" name="colour" placeholder="Search...">

                    <br>

                    <label for="owner">Owner ID:</label>
                    <input type="search" id="owner" name="owner" placeholder="Search...">

                    <br>

                    <button type="submit" id="submitButton2">Add</button> 

                </form>

                <br>
                
                <div id="results"></div>
            </div>

            

            <div class="footer">
                <h4>Footer</h4>
                <div id="message"></div>
            </div>

          </div>
          <script type="module" defer>

            import { createClient } from
               'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
            // Create a single supabase client for interacting with your database
            
            
            
            
            
            const supabase = createClient('https://ugspricsaeopciltqhlf.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVnc3ByaWNzYWVvcGNpbHRxaGxmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTIyNTYyMjAsImV4cCI6MjAyNzgzMjIyMH0.tXrrGVvxsy5yKal2ROjrDUNWqHbabRehpfI35-MF1vQ')
            
            document.getElementById('addVeh').addEventListener('submit', async function (event){
            event.preventDefault();
            let message = document.getElementById('message');
            let results = document.getElementById('results');
            let rego = document.getElementById('rego').value;
            let make = document.getElementById('make').value;
            let model = document.getElementById('model').value
            let colour = document.getElementById('colour').value;
            let owner = document.getElementById('owner').value;
           
            
            console.log('rego: ' + rego);
            console.log('make: ' + make);
            console.log('model: ' + model);
            console.log('colour: ' + colour);
            console.log('owner: ' + owner);

            if(rego === ''|| make === '' ||model === '' || colour === '' || owner === ''){
                message.innerHTML = '';
                message.innerHTML = 'Error';
                return;
            }
            
               
            try{
                const query1 = supabase.from('People').select('PersonID').eq('PersonID', owner);
                const query2 = supabase.from('Vehicles').insert({ VehicleID: rego, Make: make, Model: model, Colour: colour, OwnerID: owner})
       
                const { data: people, error: peopleErr} = await query1

                if(peopleErr)
                throw peopleErr

                console.log(people[0]);

                if(people.length === 0){
                console.log("Owner was not found")

                // let newDivArea = document.createElement('div')
                let newFrm = document.createElement('form')
                newFrm.setAttribute('id', 'newForm')
                results.appendChild(newFrm)

                let prsnID = document.createElement('label')
                prsnID.textContent = 'personID: '
                let prsnIDInput = document.createElement('input')
                prsnIDInput.setAttribute('type','search')
                prsnIDInput.setAttribute('id','personID')
                prsnIDInput.setAttribute('placeholder','create')
                prsnIDInput.setAttribute('name','prsnID')
                newFrm.appendChild(prsnID)
                newFrm.appendChild(prsnIDInput)
                newFrm.appendChild(document.createElement('br'))

                let nme = document.createElement('label')
                nme.textContent = 'name: '
                let nmeInput = document.createElement('input')
                nmeInput.setAttribute('type','search')
                nmeInput.setAttribute('id','name')
                nmeInput.setAttribute('placeholder','create')
                nmeInput.setAttribute('name','name')
                newFrm.appendChild(nme)
                newFrm.appendChild(nmeInput)
                newFrm.appendChild(document.createElement('br'))

                let addr = document.createElement('label')
                addr.textContent = 'address: '
                let addrInput = document.createElement('input')
                addrInput.setAttribute('type','search')
                addrInput.setAttribute('id','address')
                addrInput.setAttribute('placeholder','create')
                addrInput.setAttribute('name','address')
                newFrm.appendChild(addr)
                newFrm.appendChild(addrInput)
                newFrm.appendChild(document.createElement('br'))

                let db = document.createElement('label')
                db.textContent = 'dob: '
                let dbInput = document.createElement('input')
                dbInput.setAttribute('type','search')
                dbInput.setAttribute('id','dob')
                dbInput.setAttribute('placeholder','create')
                dbInput.setAttribute('name','dob')
                newFrm.appendChild(db)
                newFrm.appendChild(dbInput)
                newFrm.appendChild(document.createElement('br'))

                let lic = document.createElement('label')
                lic.textContent = 'license: '
                let licInput = document.createElement('input')
                licInput.setAttribute('type','search')
                licInput.setAttribute('id','license')
                licInput.setAttribute('placeholder','create')
                licInput.setAttribute('name','license')
                newFrm.appendChild(lic)
                newFrm.appendChild(licInput)
                newFrm.appendChild(document.createElement('br'))

                let exp = document.createElement('label')
                exp.textContent = 'expire: '
                let expInput = document.createElement('input')
                expInput.setAttribute('type','search')
                expInput.setAttribute('id','expire')
                expInput.setAttribute('placeholder','create')
                expInput.setAttribute('name','expire')
                newFrm.appendChild(exp)
                newFrm.appendChild(expInput)
                newFrm.appendChild(document.createElement('br'))

                let newBtn = document.createElement('button')
                newBtn.type = 'submit'
                newBtn.setAttribute('id','click')
                newBtn.textContent = 'Submit'
                newFrm.appendChild(newBtn)

                let personIDin = document.getElementById('personID')
                let namein = document.getElementById('name')
                let addressin = document.getElementById('address')
                let dobin = document.getElementById('dob')
                let licensein = document.getElementById('license')
                let expirein = document.getElementById('expire')



                console.log(newFrm.id)


                document.getElementById('newForm').addEventListener('submit ', async function (event){
                   
                    console.log(personIDin)
                    

                   

                })


                // message.innerHTML = ''
                // message.innerHTML = 'Error'
                // throw new Error('Owner not found')
                }

                
                 
                // const { error: vehicle } = await query2
                // if(vehicle)
                // throw new Error
                
                
            
                
            
               
            

                message.innerHTML = '';
                message.innerHTML = 'Vehicle successfully added.';
            }
                catch (error){
                    console.log(error);

                    if (error instanceof WebSocketError) {
                    message.innerHTML = 'WebSocket error occurred. Please try again later.';
                } else {
                    message.innerHTML = 'An error occurred. Please try again later.';
                }
            }
                
                
                
                    
                    
                });
                      </script> 
                      
                </body>
            
            </html>
    </body>

</html>